<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-cli.html">cli</a></li><li><a href="module-compile.html">compile</a><ul class='methods'><li data-type='method'><a href="module-compile.html#~compile">compile</a></li></ul></li><li><a href="module-compile_utils_build.html">compile/utils/build</a><ul class='methods'><li data-type='method'><a href="module-compile_utils_build.html#~add">add</a></li><li data-type='method'><a href="module-compile_utils_build.html#~create">create</a></li><li data-type='method'><a href="module-compile_utils_build.html#~init">init</a></li><li data-type='method'><a href="module-compile_utils_build.html#~load">load</a></li></ul></li><li><a href="module-compile_utils_buildDirectory.html">compile/utils/buildDirectory</a><ul class='methods'><li data-type='method'><a href="module-compile_utils_buildDirectory.html#~buildDirectory">buildDirectory</a></li></ul></li><li><a href="module-finish.html">finish</a><ul class='methods'><li data-type='method'><a href="module-finish.html#~finish">finish</a></li></ul></li><li><a href="module-finish_sanityChecks.html">finish/sanityChecks</a><ul class='methods'><li data-type='method'><a href="module-finish_sanityChecks.html#~sanityChecks">sanityChecks</a></li></ul></li><li><a href="module-helpers_errors.html">helpers/errors</a><ul class='methods'><li data-type='method'><a href="module-helpers_errors.html#~error">error</a></li><li data-type='method'><a href="module-helpers_errors.html#~getErrorCount">getErrorCount</a></li><li data-type='method'><a href="module-helpers_errors.html#~getErrors">getErrors</a></li><li data-type='method'><a href="module-helpers_errors.html#~getExceptions">getExceptions</a></li><li data-type='method'><a href="module-helpers_errors.html#~getWarningCount">getWarningCount</a></li><li data-type='method'><a href="module-helpers_errors.html#~getWarnings">getWarnings</a></li><li data-type='method'><a href="module-helpers_errors.html#~reset">reset</a></li><li data-type='method'><a href="module-helpers_errors.html#~warning">warning</a></li></ul></li><li><a href="module-helpers_log.html">helpers/log</a><ul class='methods'><li data-type='method'><a href="module-helpers_log.html#~error">error</a></li><li data-type='method'><a href="module-helpers_log.html#~info">info</a></li><li data-type='method'><a href="module-helpers_log.html#~log">log</a></li><li data-type='method'><a href="module-helpers_log.html#~raw">raw</a></li><li data-type='method'><a href="module-helpers_log.html#~warning">warning</a></li></ul></li><li><a href="module-helpers_options.html">helpers/options</a><ul class='methods'><li data-type='method'><a href="module-helpers_options.html#~addAgency">addAgency</a></li><li data-type='method'><a href="module-helpers_options.html#~addAgencyConfig">addAgencyConfig</a></li><li data-type='method'><a href="module-helpers_options.html#~addAgencyNotes">addAgencyNotes</a></li><li data-type='method'><a href="module-helpers_options.html#~agency">agency</a></li><li data-type='method'><a href="module-helpers_options.html#~agencyCount">agencyCount</a></li><li data-type='method'><a href="module-helpers_options.html#~get">get</a></li><li data-type='method'><a href="module-helpers_options.html#~set">set</a></li></ul></li><li><a href="module-run.html">run</a><ul class='methods'><li data-type='method'><a href="module-run.html#~start">start</a></li></ul></li><li><a href="module-update.html">update</a><ul class='methods'><li data-type='method'><a href="module-update.html#~update">update</a></li></ul></li><li><a href="module-update_default.html">update/default</a><ul class='methods'><li data-type='method'><a href="module-update_default.html#~defaultUpdate">defaultUpdate</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>Right Track Database Builder</h1><p><strong>node module:</strong> <a href="https://www.npmjs.com/package/right-track-db-build">right-track-db-build</a><br><strong>GitHub repo:</strong> <a href="https://github.com/right-track/right-track-db-build">right-track/right-track-db-build</a></p>
<hr>
<p>This project is used to compile a <strong>Right Track Database</strong>: a SQLite database
containing GTFS transit data and additional Right Track data tables for a
single transit agency.  This database is used in the various <strong>Right Track</strong>
projects, such as the <a href="https://github.com/right-track/right-track-server">right-track-server</a>
and is required for any data queries performed by the <a href="https://github.com/right-track/right-track-core">right-track-core</a>
library.</p>
<h2>Installation</h2><p>This project can be installed via <code>npm</code>:</p>
<pre class="prettyprint source"><code>npm install -g right-track-db-build</code></pre><p>When installed globally, <code>npm</code> will link the executable <code>right-track-db-build</code>
into your <code>$PATH</code>.</p>
<h2>Dependencies</h2><p>In order to compile a database for a specific transit agency, a <strong>Right Track
Agency</strong> module (such as <a href="https://github.com/right-track/right-track-agency-mnr">right-track-agency-mnr</a>)
will also need to be installed.  The agency module provides information on
where/how to obtain the agency's GTFS data as well as additional database
compilation instructions.  The compiled database (and an archive of compiled
databases) will be kept in the Right Track Agency's module.</p>
<p>The agencies are provided to the <code>right-track-db-build</code> script via the
<code>--agency</code> command line flag.</p>
<p><strong>NOTE:</strong> There are no Right Track Agency modules listed as dependencies
in this project's <code>package.json</code> file.  The Agency modules will have
to be installed separately and referenced manually using the <code>--agency</code>
CLI flag.</p>
<h2>Usage</h2><p>Example: Update GTFS data and compile a database for Metro North Railroad:</p>
<pre class="prettyprint source"><code>right-track-db-build --agency right-track-agency-mnr</code></pre><p>The command line utility has the following usage:</p>
<pre class="prettyprint source lang-text"><code>Right Track Database Builder
Module: right-track-db-build
Version: 1.0.0
----------------------------
Usage:
  right-track-db-build [options] --agency &lt;declaration> [agency options] ...
options:
  --force|-f       Force a GTFS update and database compilation
  --test|-t        Test the DB compilation (does not install)
  --post|-p &lt;file> Define a post-install script to run after update & compilation
  --help|-h        Display this usage information
  --version|-v     Display the DB Build script version
agency declaration:
  Declare an agency to check for GTFS updates/compile database.  The agency
  can be declared by module name, agency id or file path.  For example:
  --agency right-track-agency-mnr
  --agency mnr
  --agency ./path/to/right-track-agency-mnr
agency options:
  These options have to be proceeded by an agency declaration (--agency &lt;...>)
  --config|-c &lt;file>
     Specify the path to an optional agency configuration file
  --notes|-n &lt;notes>
     Specify agency update notes to be included in the new database</code></pre><h1>Additional Scripts</h1><h2>Agency Scripts</h2><p>Each Agency can provide scripts that override the default update script,
run after the update procedure, and run after the compilation process.</p>
<h3>Update Script</h3><p>If this script is present, it will override the default update check script.</p>
<p>The default update script makes a HEAD request to the URL in the agency's
config property (<code>build.updateURL</code>).  If the Last-Modified Header is newer
than the saved date/time (or the saved date/time does not exist) then
the GTFS zip file from the URL will be downloaded and unzipped into the
<code>./db-build/gtfs/</code> directory of the agency module.</p>
<p>This script can be used to provide a different update and install
procedure.  The script should check if a newer GTFS source file
is available.  If an update is available, it should download and
install the GTFS files into the agency module's <code>./db-build/gtfs/</code>
directory.</p>
<p><strong>Location:</strong> {{AGENCY_MODULE}}/db-build/src/update.js</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>{Object} options</code> - The DB-Build Agency Options</li>
<li><code>{function|Object} log</code> - The DB-Build Log functions (see <code>./src/helpers/log.js</code>)</li>
<li><code>{Object} errors</code> - The DB-Build Error functions (see <code>./src/helpers/errors.js</code>)</li>
<li><code>{function} callback</code> - The callback function to return to the build script<ul>
<li><code>{boolean} requested</code> - Set to <code>true</code> when a GTFS update has been requested</li>
<li><code>{boolean} successful</code> - Set to <code>true</code> when a GTFS update has been successfully installed</li>
<li><code>{string} [published]</code> - (optional) The date/time stamp of the GTFS published date/time.
If not provided, this will be read from the <code>./db-build/gtfs/published.txt</code> file.</li>
<li><code>{string} [notes]</code> - (optional) The database build notes.
If not provided, this will be automatically generated from the compile and publish dates.</li>
</ul>
</li>
</ul>
<h3>Post-Update Script</h3><p>If this script is present, it will run after the update procedure
and before the database compilation process.</p>
<p>This script can be used to make any agency-specific changes to the
agency's GTFS files before the database compilation begins.</p>
<p><strong>Location:</strong> {{AGENCY_MODULE}}/db-build/src/postUpdate.js</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>{Object} options</code> - The DB-Build Agency Options</li>
<li><code>{function|Object} log</code> - The DB-Build Log functions (see <code>./src/helpers/log.js</code>)</li>
<li><code>{Object} errors</code> - The DB-Build Error functions (see <code>./src/helpers/errors.js</code>)</li>
<li><code>{function} callback</code> - The callback function to return to the build script (no parameters)</li>
</ul>
<h3>Peak Calculator Script</h3><p>If this script is present, it will determine if a Trip should be considered
a peak trip (ie, operates during agency-specified rush hours and has higher
than usual fares).  By default the DB-Build script will mark all Trips as
not peak (value of <code>0</code>).  This script should return a peak status value
for the specified Trip with one of these possible values:</p>
<ul>
<li><code>0</code> - the Trip is never considered a Peak trip</li>
<li><code>1</code> - the Trip is always considered a Peak trip when it runs (excluding
Holidays that do not have Peak trips)</li>
<li><code>2</code> - the Trip may be considered a Peak trip, if the date of the Trip
is a weekday (excluding Holidays that do not have Peak trips)</li>
</ul>
<p>When the <code>right-track-core</code> library creates a <code>Trip</code> instance, it will consult
the <code>rt_holidays</code> table, if present.  If a <code>Trip</code> is being created for a date
that is considered a Holiday and the holiday has a <code>peak</code> value of <code>false</code>, then
all Trips running on that date will be considered Off-Peak.</p>
<p><strong>Location:</strong> {{AGENCY_MODULE}}/db-build/src/peak.js</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>{Object} db</code> - The SQLite Database instance of the database currently being built</li>
<li><code>{string} tripId</code> - The GTFS Trip ID of the Trip to determine the peak status of</li>
<li><code>{function} callback</code> - The callback function to return to the build script<ul>
<li><code>{int} peak</code> - The peak status of the Trip</li>
</ul>
</li>
</ul>
<h3>Post-Compile Script</h3><p>If this script is present, it will run after the database compilation process
and before the database installation.</p>
<p>This script can be used to make any agency-specific changes to the compiled
Right Track database before it is installed.</p>
<p><strong>Location:</strong> {{AGENCY_MODULE}}/db-build/src/postCompile.js</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>{Object} options</code> - The DB-Build Agency Options</li>
<li><code>{Object} db</code> - SQLite3 reference to the compiled database</li>
<li><code>{function|Object} log</code> - The DB-Build Log functions (see <code>./src/helpers/log.js</code>)</li>
<li><code>{Object} errors</code> - The DB-Build Error functions (see <code>./src/helpers/errors.js</code>)</li>
<li><code>{function} callback</code> - The callback function to return to the build script (no parameters)</li>
</ul>
<h2>Post-Install Script</h2><p>You can provide an additional post-install script via the <code>--post</code> command
line flag.</p>
<p>This is a JavaScript module that exports a single function.  This function takes
the following arguments:</p>
<ul>
<li><code>{Options}</code> Database Build Options</li>
<li><code>{RTException[]}</code> List of Exceptions (Warnings &amp; Errors) encountered during the build process</li>
<li><code>{function}</code> Callback function called when the post-install script has finished (takes no arguments)</li>
</ul>
<p>This script can be used to finalize the installation of the new database (ie, copy
the database to a server for distribution), send an alert of an update, etc.</p>
<p><strong>NOTE:</strong> The Post-Install script will not run if the <code>--test</code> flag is provided.</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Feb 20 2018 11:28:56 GMT-0500 (EST) using the <a href="https://github.com/dwaring87/docdash">@dwaring87/docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>